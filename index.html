<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Master</title>
    
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #eaeff2; display: flex; justify-content: center; padding: 40px; }
        .container { width: 100%; max-width: 900px; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 5px; }
        p.subtitle { text-align: center; color: #7f8c8d; margin-bottom: 30px; }
        
        /* Input & Controls */
        .controls { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; }
        
        select { padding: 15px; border-radius: 8px; border: 2px solid #ddd; font-size: 16px; background: white; cursor: pointer; }
        select:focus { border-color: #3498db; outline: none; }

        input { flex: 1; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; min-width: 200px; }
        input:focus { border-color: #3498db; outline: none; }
        
        .btn { padding: 15px 25px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; white-space: nowrap; }
        .btn-code { background: #2980b9; }
        .btn-explain { background: #8e44ad; }
        .btn-pdf { background: #c0392b; float: right; margin-top: 20px; display: none; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }

        /* Code Box */
        .code-wrapper { position: relative; margin-top: 20px; display: none; }
        pre { border-radius: 8px; max-height: 500px; }
        
        .copy-btn {
            position: absolute; top: 10px; right: 10px;
            background: rgba(255,255,255,0.2); color: white;
            border: 1px solid rgba(255,255,255,0.4); padding: 5px 10px;
            border-radius: 5px; cursor: pointer; font-size: 12px; z-index: 10;
        }
        .copy-btn:hover { background: white; color: black; }

        /* Output & Explain */
        .box { padding: 20px; border-radius: 8px; margin-top: 20px; display: none; white-space: pre-wrap; }
        .output { background: #f1f2f6; border-left: 5px solid #27ae60; font-family: monospace; color: #333; }
        .explanation { background: #fff3cd; border-left: 5px solid #f39c12; color: #856404; }

        .loader { display: none; text-align: center; margin-top: 20px; font-weight: bold; color: #555; }
    </style>
</head>
<body>

    <div class="container">
        <h1>ðŸ¤– AI Code Master</h1>
        <p class="subtitle">Select a language, ask a question, get the code.</p>
        
        <div class="controls">
            <select id="language">
                <option value="java">Java</option>
                <option value="python">Python</option>
                <option value="cpp">C++</option>
                <option value="c">C Programming</option>
                <option value="javascript">JavaScript</option>
                <option value="sql">SQL</option>
                <option value="html">HTML/CSS</option>
            </select>

            <input type="text" id="question" placeholder="e.g., Binary Search, Palindrome, Calculator...">
            
            <button class="btn btn-code" onclick="solve('solve')">âš¡ Generate Code</button>
            <button class="btn btn-explain" onclick="solve('explain')">ðŸ§  Explain</button>
        </div>

        <div id="loader" class="loader">Thinking...</div>

        <div id="code-section" class="code-wrapper">
            <button class="copy-btn" onclick="copyCode()">ðŸ“‹ Copy</button>
            <pre><code id="code-display" class="language-java"></code></pre>
        </div>

        <div id="output-box" class="box output"></div>
        <div id="explain-box" class="box explanation"></div>

        <button id="pdf-btn" class="btn btn-pdf" onclick="window.print()">ðŸ“„ Save PDF</button>
    </div>

    <script>
        async function solve(mode) {
            const questionInput = document.getElementById('question').value;
            const language = document.getElementById('language').value;
            const loader = document.getElementById('loader');
            const codeSection = document.getElementById('code-section');
            const codeDisplay = document.getElementById('code-display');
            const outputBox = document.getElementById('output-box');
            const explainBox = document.getElementById('explain-box');
            const pdfBtn = document.getElementById('pdf-btn');

            if (!questionInput) return alert("Please enter a question!");

            // 1. Construct the prompt with the selected language
            // e.g., "Write Python code for Binary Search"
            const fullPrompt = `${mode === 'solve' ? 'Write ' + language + ' code for ' : ''}${questionInput}`;

            // Reset UI
            loader.style.display = 'block';
            codeSection.style.display = 'none';
            outputBox.style.display = 'none';
            explainBox.style.display = 'none';
            pdfBtn.style.display = 'none';

            const endpoint = mode === 'solve' ? '/api/solve' : '/api/explain';

            try {
                // YOUR RAILWAY LINK
                const res = await fetch('https://smart-solver-final-production.up.railway.app' + endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: fullPrompt
                });

                const rawText = await res.text();
                let cleanText = rawText;

                try {
                    const json = JSON.parse(rawText);
                    if (json.candidates) cleanText = json.candidates[0].content.parts[0].text;
                } catch (e) {}

                if (mode === 'solve') {
                    const parts = cleanText.split('#####');
                    
                    // Update Code Box Class for Colors (e.g., language-python)
                    codeDisplay.className = `language-${language}`;
                    codeDisplay.textContent = parts[0].trim();
                    
                    outputBox.textContent = parts[1] ? "Expected Output:\n" + parts[1].trim() : "Output pending...";
                    
                    codeSection.style.display = 'block';
                    outputBox.style.display = 'block';
                    pdfBtn.style.display = 'block';
                    
                    // Trigger Re-Coloring
                    Prism.highlightAll();
                } else {
                    explainBox.textContent = cleanText;
                    explainBox.style.display = 'block';
                }

            } catch (error) {
                alert("Error: " + error.message);
            } finally {
                loader.style.display = 'none';
            }
        }

        function copyCode() {
            const code = document.getElementById('code-display').textContent;
            navigator.clipboard.writeText(code);
            alert("Code Copied! ðŸ“‹");
        }
    </script>

</body>
</html>