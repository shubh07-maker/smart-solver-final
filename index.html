<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Java Lab Assistant Pro</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-java.min.js"></script>
    
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; display: flex; justify-content: center; padding: 40px; }
        .container { width: 100%; max-width: 900px; background: white; padding: 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; }
        
        /* Input & Buttons */
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 15px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; }
        
        .btn { padding: 15px 20px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; color: white; transition: 0.2s; }
        .btn-code { background: #3498db; }
        .btn-explain { background: #9b59b6; }
        .btn-pdf { background: #e74c3c; float: right; margin-top: 20px; }
        .btn:hover { opacity: 0.9; transform: translateY(-2px); }

        /* Code Box (With Copy Button) */
        .code-wrapper { position: relative; margin-top: 20px; display: none; }
        pre { border-radius: 8px; max-height: 400px; }
        
        .copy-btn {
            position: absolute; top: 10px; right: 10px;
            background: rgba(255,255,255,0.2); color: white;
            border: 1px solid rgba(255,255,255,0.4); padding: 5px 10px;
            border-radius: 5px; cursor: pointer; font-size: 12px;
        }
        .copy-btn:hover { background: white; color: black; }

        /* Output & Explanation */
        .box { padding: 20px; border-radius: 8px; margin-top: 20px; display: none; white-space: pre-wrap; }
        .output { background: #f1f2f6; border-left: 5px solid #2ecc71; font-family: monospace; }
        .explanation { background: #fff3cd; border-left: 5px solid #f1c40f; color: #856404; }

        .loader { display: none; text-align: center; margin-top: 20px; font-weight: bold; color: #555; }
    </style>
</head>
<body>

    <div class="container">
        <h1>â˜• Java Lab Assistant <span style="font-size:0.5em; color:purple">PRO</span></h1>
        
        <div class="input-group">
            <input type="text" id="question" placeholder="e.g., Binary Search Program">
            <button class="btn btn-code" onclick="solve('solve')">âš¡ Code</button>
            <button class="btn btn-explain" onclick="solve('explain')">ðŸ§  Explain</button>
        </div>

        <div id="loader" class="loader">Thinking...</div>

        <div id="code-section" class="code-wrapper">
            <button class="copy-btn" onclick="copyCode()">ðŸ“‹ Copy</button>
            <pre><code id="code-display" class="language-java"></code></pre>
        </div>

        <div id="output-box" class="box output"></div>

        <div id="explain-box" class="box explanation"></div>

        <button id="pdf-btn" class="btn btn-pdf" style="display:none" onclick="window.print()">ðŸ“„ Save PDF</button>
    </div>

    <script>
        async function solve(mode) {
            const question = document.getElementById('question').value;
            const loader = document.getElementById('loader');
            const codeSection = document.getElementById('code-section');
            const codeDisplay = document.getElementById('code-display');
            const outputBox = document.getElementById('output-box');
            const explainBox = document.getElementById('explain-box');
            const pdfBtn = document.getElementById('pdf-btn');

            if (!question) return alert("Please enter a topic!");

            // Reset UI
            loader.style.display = 'block';
            codeSection.style.display = 'none';
            outputBox.style.display = 'none';
            explainBox.style.display = 'none';
            pdfBtn.style.display = 'none';

            // Determine Endpoint
            const endpoint = mode === 'solve' ? '/api/solve' : '/api/explain';

            try {
                // YOUR RAILWAY LINK HERE
                const res = await fetch('https://smart-solver-final-production.up.railway.app' + endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'text/plain' },
                    body: question
                });

                const rawText = await res.text();
                let cleanText = rawText;

                // Parse JSON from Gemini
                try {
                    const json = JSON.parse(rawText);
                    if (json.candidates) cleanText = json.candidates[0].content.parts[0].text;
                } catch (e) {}

                if (mode === 'solve') {
                    // Handle Code & Output
                    const parts = cleanText.split('#####');
                    codeDisplay.textContent = parts[0].trim();
                    outputBox.textContent = parts[1] ? "Output:\n" + parts[1].trim() : "Output pending...";
                    
                    codeSection.style.display = 'block';
                    outputBox.style.display = 'block';
                    pdfBtn.style.display = 'block';
                    
                    // APPLY COLORS (Prism.js)
                    Prism.highlightAll();
                } else {
                    // Handle Explanation
                    explainBox.textContent = cleanText;
                    explainBox.style.display = 'block';
                }

            } catch (error) {
                alert("Error: " + error.message);
            } finally {
                loader.style.display = 'none';
            }
        }

        function copyCode() {
            const code = document.getElementById('code-display').textContent;
            navigator.clipboard.writeText(code);
            alert("Code Copied! ðŸ“‹");
        }
    </script>

</body>
</html>